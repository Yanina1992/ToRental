<h1 class="p-4">I nostri veicoli</h1>
<app-table></app-table>
<!--Crea veicolo----------------------------------------------->
<div class="d-flex flex-column align-items-center">
  <h2>Nuovo veicolo</h2>
  <form #veicoliForm="ngForm">
    <h3>Inserisci i dati del veicolo</h3>

    <!--Tipo veicolo-->
    <div class="mb-3">
      <label for="tipo_veicolo_nome" class="form-label">Tipo veicolo</label>
      <select
        id="tipo_veicolo_nome"
        class="form-select"
        required
        [(ngModel)]="selectedTipoVeicoloId"
        (ngModelChange)="onTipeVeicoloChange(selectedTipoVeicoloId)"
        name="tipo_veicolo_nome"
         #tipo_veicolo_nome="ngModel"
      >
     
        <option
          *ngFor="let tipoVeicolo of tipiVeicoli"
          [value]="tipoVeicolo.id"
        >
          {{ tipoVeicolo.nome }}
        </option>
      </select>

      <div 
      *ngIf="selectedTipoVeicoloId == 0 && formSubmitted"
      class="alert text-danger ps-0">
      Selezionare una tipologia di veicolo.
      </div>

    </div>

    <!--Marca-->
    <div class="mb-3">
      <label for="marca" class="form-label">Marca</label>
      <select
        id="marca"
        class="form-select"
        required
        [(ngModel)]="selectedMarcaId"
        (ngModelChange)="onMarcaChange(selectedMarcaId)"
        name="marca"
        #marca="ngModel"
      >
        <option *ngFor="let marca of marche" [value]="marca.id">
          {{ marca.nome }}
        </option>
      </select>

      <div 
      *ngIf="selectedMarcaId == null && formSubmitted"
      class="alert text-danger ps-0">
      Selezionare una marca.
      </div>

    </div>

    <!--Modello-->
    <div class="mb-3">
      <label for="modello" class="form-label">Modello</label>
      <select
        id="modello"
        class="form-select"
        [disabled]="!selectedMarcaId"
        required
        [(ngModel)]="selectedModelloId"
        (ngModelChange)="onModelloChange(selectedModelloId)"
        name="modello"
        #modello="ngModel"
      >
        <option *ngFor="let modello of modelli" [value]="modello.id">
          {{ modello.nome }}
        </option>
      </select>

      <div 
      *ngIf="selectedModelloId == 0 && formSubmitted"
      class="alert text-danger ps-0">
      Selezionare un modello.
      </div>


    </div>

    <!--Cilindrata-->
    <div class="mb-3">
      <label for="cilindrata" class="form-label">Cilindrata</label>
      <input
        type="number"
        class="form-control"
        id="cilindrata"
        min="0"
        [(ngModel)]="veicoloForm.cilindrata"
        name="cilindrata"
        #cilindrata="ngModel"
      />
    </div>

    <!--Colore-->
    <div class="mb-3">
      <label for="colore" class="form-label">Colore</label>
      <input
      type="text"
      class="form-control"
      id="colore"
      [(ngModel)]="veicoloForm.colore"
      name="colore" 
      #colore="ngModel"
      />
    </div>

    <!--Destinazione d'uso-->
    <div class="mb-3">
      <label for="destinazione_uso_nome" class="form-label"
        >Destinazione d'uso.</label
      >
      <select
        id="destinazione_uso_nome"
        class="form-select"

        [(ngModel)]="selectedDestinazioneUsoId"
        required
        (ngModelChange)="onDestinazioneUsoChange(selectedDestinazioneUsoId)"
        name="destinazioneUso"
      >
        <option
          *ngFor="let destinazione of destinazioni"
          [value]="destinazione.id"
        >
          {{ destinazione.nome }}
        </option>
      </select>

      <div 
      *ngIf="selectedDestinazioneUsoId == 0 && formSubmitted"
      class="alert text-danger ps-0">
      Selezionare la destinazione d'uso
      </div>

    </div>

    <!--Massa-->
    <div class="mb-3">
      <label for="massa" class="form-label">Massa</label>
      <input
      type="text" 
      class="form-control" 
      id="massa"
      pattern="[0-9]*"
      min="0"
      [(ngModel)]="veicoloForm.massa"
      name="massa" />
    </div>

    <!--Numero assi-->
    <div class="mb-3">
      <label for="numero_assi" class="form-label">Numero assi</label>
      <input
        type="number"
        class="form-control"
        id="numero_assi"
        [(ngModel)]="veicoloForm.numero_assi"
        required
        name="numero_assi"
      />

      <div 
      *ngIf="veicoloForm.numero_assi == 0 && formSubmitted"
      class="alert text-danger ps-0">
      Selezionare il numero di assi.
      </div>

    </div>

    <!--Portata-->
    <div class="mb-3">
      <label for="portata" class="form-label">Portata</label>
      <input 
      type="number" 
      class="form-control" 
      id="portata" 
      [(ngModel)]="veicoloForm.portata"
      min="0"
      name="portata" />
    </div>

    <!--Potenza-->
    <div class="mb-3">
      <label for="potenza" class="form-label">Potenza</label>
      <input 
      type="number" 
      class="form-control" 
      id="potenza" 
      [(ngModel)]="veicoloForm.potenza"
      min="0"
      name="potenza" />
    </div>

    <!--Società-->
    <div class="mb-3">
      <label for="societa_nome" class="form-label">Società</label>
      <select
        id="societa_nome"
        class="form-select"
        [(ngModel)]="selectedSocietaId"
        required
        (ngModelChange)="onSocietaChange(selectedSocietaId)"
        name="societa"
      >
        <option *ngFor="let societa of societas" [value]="societa.id">
          {{ societa.nome }}
        </option>
      </select>

      <div 
      *ngIf="selectedSocietaId == 0 && formSubmitted"
      class="alert text-danger ps-0">
      Selezionare la società proprietaria del veicolo.
      </div>

    </div>

    <!--Targa-->
    <div class="mb-3">
      <label for="targa" class="form-label">Targa</label>
      <input 
      type="text" 
      class="form-control" 
      id="targa" 
      [(ngModel)]="veicoloForm.targa"
      required
      minlength="5"
      maxlength="10"
      pattern="[a-zA-Z0-9]*"
      name="targa"
      #targa = "ngModel" />

      <div 
      *ngIf="targa.errors && formSubmitted"
      class="alert text-danger ps-0">
 <!--GESTIRE IL FATTO CHE LA TARGA NON DEVE ESSERE GIà PRESENTE NEL DB-->
      <div *ngIf="targa.errors?.['required']">
        La targa è obbligatoria.
      </div>
      <div *ngIf="targa.errors?.['minlength'] || targa.errors?.['maxlength']">
        La targa inserita è incompleta.
      </div>
      </div>

    </div>

    <!--Tipo alimentazione-->
    <div class="mb-3">
      <label for="tipo_alimentazione_nome" class="form-label"
        >Alimentazione</label
      >
      <select
        id="tipo_alimentazione_nome"
        name="alimentazione"
        class="form-select"
        [(ngModel)]="selectedAlimentazioneId"
        required
        (ngModelChange)="onAlimentazioneChange(selectedAlimentazioneId)"
        
      >
        <option
          *ngFor="let tipoAlimentazione of tipiAlimentazione"
          [value]="tipoAlimentazione.id"
        >
          {{ tipoAlimentazione.nome }}
        </option>
      </select>

      <div 
      *ngIf="selectedAlimentazioneId == 0 && formSubmitted"
      class="alert text-danger ps-0">
      Selezionare un tipo di alimentazione.
      </div>

    </div>

    <!--Allestimento-->
    <div class="mb-3">
      <label for="tipo_allestimento_nome" class="form-label"
        >Allestimento</label
      >
      <select
        id="tipo_allestimento_nome"
        class="form-select"
        [(ngModel)]="selectedAllestimentoId"
        required
        (ngModelChange)="onAllestimentoChange(selectedAllestimentoId)"
        name="allestimento"
      >
        <option
          *ngFor="let allestimento of allestimenti"
          [value]="allestimento.id"
        >
          {{ allestimento.nome }}
        </option>
      </select>

      <div 
      *ngIf="selectedAllestimentoId == 0 && formSubmitted"
      class="alert text-danger ps-0">
      Selezionare un tipo di allestimento.
      </div>

    </div>

    <!-- Tipo asse-->
    <div class="mb-3">
      <label for="tipo_asse_nome" class="form-label">Tipo asse</label>
      <select
        id="tipo_asse_nome"
        class="form-select"
        [(ngModel)]="selectedTipoAsseId"
        required
        (ngModelChange)="onTipoAsseChange(selectedTipoAsseId)"
        name="tipoAsse"
      >
        <option *ngFor="let tipoAsse of tipiAsse" [value]="tipoAsse.id">
          {{ tipoAsse.nome }}
        </option>
      </select>

      <div 
      *ngIf="selectedTipoAsseId == null && formSubmitted"
      class="alert text-danger ps-0">
      Selezionare un tipo di asse.
      </div>
    </div>

    <!--Cambio-->
    <div class="mb-3">
      <label for="tipo_cambio_nome" class="form-label">Cambio</label>
      <select
        id="tipo_cambio_nome"
        class="form-select"
        [(ngModel)]="selectedCambioId"
        required
        (ngModelChange)="onCambioChange(selectedCambioId)"
        name="cambio"
      >
        <option *ngFor="let tipoCambio of tipiCambio" [value]="tipoCambio.id">
          {{ tipoCambio.nome }}
        </option>
      </select>

      <div 
      *ngIf="selectedCambioId == null && formSubmitted"
      class="alert text-danger ps-0">
      Selezionare un tipo di cambio.
      </div>
    </div>

    <!--Data immatricolazione-->
    <div class="mb-3">
      <label for="data_immatricolazione" class="form-label"
        >Data immatricolazione</label
      >

      <div class="container-fluid">
        <div class="row">
          <!--<div class="col col-1 p-0">
            <i
              class="fa-solid fa-calendar-days form-control d-flex justify-content-center"
            ></i>
          </div>-->

          <div class="col col-9 p-0">
            <input
              class="form-control"
              placeholder="Scegli una data"
              [(ngModel)]="veicoloForm.data_immatricolazione"
              (click)="toggleDatePicker()"
              name="dataImmatricolazione"
              [value]="formatDate(model)"
              readonly
              #dataImmatricolazione="ngModel"
              required
            />
 
            <div *ngIf="dataImmatricolazione.touched" click="toggleDatePicker()">
          ciaone
            </div>

           <!--<i class="fa-solid fa-calendar-days"></i>-->
          </div>

          <div class="col col-3 p-0">
            <button class="form-control" (click)="selectToday()">Oggi</button>
          </div>
        </div>
      </div>

      <ngb-datepicker
        #dp
        [(ngModel)]="model"
        (navigate)="date = $event.next"
        (closed)="isDatepickerOpen = false"
        *ngIf="isDatepickerOpen"
        name="datePicker"
      >
      </ngb-datepicker>


     <!--<div>Selected date: {{ model | json }}</div>-->
    </div>

    <button type="submit" class="btn btn-primary" (click)="creaVeicolo()">Salva veicolo</button>
  </form>
</div>